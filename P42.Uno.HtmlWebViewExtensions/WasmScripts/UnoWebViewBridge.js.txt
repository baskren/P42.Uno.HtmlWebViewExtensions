
function UnoWebViewBridge_PostMessage(payload) {
    let obj = new Object();
    obj.Session = sessionStorage.getItem('Uno.WebView.Session');
    obj.Instance = sessionStorage.getItem('Uno.WebView.Instance');
    obj.Payload = payload;
    let message = JSON.stringify(obj);
    console.log("UnoWebViewBridge_PostMessage: message: " + message);
    window.parent.postMessage(message, "*");
}

function UnoWebViewBridge_ReceiveMessage(event) {
    console.log("UnoWebViewBridge_ReceiveMessage: event.data: " + event.data);
    if (event.data.Session == sessionStorage.getItem('Uno.WebView.Session')) {
        if (event.data.Method == 'Navigate')
        {
            UnoWebViewBridge_Assign(event.data.Payload);
        }
        else if (event.data.Method == 'NavigateToText')
        {
            var newsrc = 'data:text/html;charset=utf-8;base64,' + event.data.Payload;
            console.log('UnoWebViewBridge_ReceiveMessage NavigateToText newsrc=' + newsrc);
            window.location.assign(newsrc);
            //document.write(atob(event.data.Payload));
        }
    }
}

function UnoWebViewBridge_Initiate() {

    const currentWindowOnLoad = window.onload;
    window.onload = function () {
        if (currentWindowOnLoad !== undefined && currentWindowOnLoad !== null)
            currentWindowOnLoad();

        window.addEventListener("message", UnoWebViewBridge_ReceiveMessage, false);
        
        console.log("history.length: " + window.history.length);
        console.log("history.state: " + window.history.state);

        console.log("UnoWebViewBridge_initiate: window.onLoad: EXIT");
    }
    console.log("UnoWebViewBridge_initiate: EXIT");
}


function UnoWebViewBridge_Assign(x) {
    window.location.assign(x);
}

function UnoWebViewBridge_Reload(fromNetwork) {
    window.location.reload(fromNetwork);
}

function UnoWebViewBridge_GoBack() {
    window.history.back();
}

function UnoWebViewBridge_GoForward() {
    window.history.forward();
}

UnoWebViewBridge_Initiate();
console.log("UnoWebBridge EXIT");

